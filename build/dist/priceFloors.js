pbjsChunk([173],{708:function(e,t,o){e.exports=o(709)},709:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o.d(t,"allowedFields",function(){return g}),o.d(t,"_floorDataForAuction",function(){return R}),o.d(t,"fieldMatchingFunctions",function(){return U}),t.getFirstMatchingFloor=E,t.getBiddersCpmAdjustment=w,t.calculateAdjustedFloor=P,t.getFloor=M,t.getFloorsDataForAuction=B,t.getFloorDataFromAdUnits=V,t.updateAdUnitsForAuction=x,t.pickRandomModel=q,t.createFloorsDataForAuction=z,t.continueAuction=W,t.isFloorsDataValid=H,t.parseFloorData=J,t.requestBidsHook=L,t.handleFetchResponse=K,t.generateAndHandleFetch=X,t.handleSetFloorsConfig=Z,t.addBidResponseHook=$;var O=o(17),r=o(3),j=o(0),n=o(4),a=o(9),i=o.n(a),c=o(5),F=o.n(c),s=o(11),A=o(34),u=o(10),S=o.n(u),d=o(21);function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){if(null==e)return{};var o,r=function(e,t){if(null==e)return{};var o,r,n={},a=Object.keys(e);for(r=0;r<a.length;r++)o=a[r],0<=t.indexOf(o)||(n[o]=e[o]);return n}(e,t);if(Object.getOwnPropertySymbols)for(var n=Object.getOwnPropertySymbols(e),a=0;a<n.length;a++)o=n[a],0<=t.indexOf(o)||Object.prototype.propertyIsEnumerable.call(e,o)&&(r[o]=e[o]);return r}function C(){return(C=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e}).apply(this,arguments)}function p(t,e){var o,r=Object.keys(t);return Object.getOwnPropertySymbols&&(o=Object.getOwnPropertySymbols(t),e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,o)),r}function k(n){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?p(Object(a),!0).forEach(function(e){var t,o,r;t=n,r=a[o=e],o in t?Object.defineProperty(t,o,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[o]=r}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):p(Object(a)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(a,e))})}return n}var m,T="Price Floors",h=Object(n.b)(1e4),g=["gptSlot","adUnitCode","size","domain","mediaType"],y=!1,b=!1,v={},D=[],R={};var U={size:function(e,t){return j.parseGPTSingleSizeArray(t.size)||"*"},mediaType:function(e,t){return t.mediaType||"banner"},gptSlot:function(e){return j.getGptSlotInfoForAdUnitCode(e.adUnitCode).gptSlot},domain:function(){return m||(e=Object(d.a)().referer,m=j.parseUrl(e,{noDecodeWholeURL:!0}).hostname);var e},adUnitCode:function(e){return e.adUnitCode}};function E(t,e){var o,r,n,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=(o=j.deepAccess(t,"schema.fields")||[],r=e,n=a,o.reduce(function(e,t){var o=U[t](r,n)||"*";return e.push("*"===o?["*"]:[o.toLowerCase(),"*"]),e},[]));if(!i.length)return{matchingFloor:t.default};var c=i.map(function(e){return e[0]}).join("-"),s=j.deepAccess(t,"matchingInputs.".concat(c));if(s)return k({},s);var u,d,l=(u=i,d=j.deepAccess(t,"schema.delimiter")||"|",u.reduce(function(e,o){var r=[];return e.map(function(t){o.map(function(e){r.push(t+d+e)})}),r}).sort(function(e,t){return e.split("*").length-t.split("*").length})),f=S()(l,function(e){return t.values.hasOwnProperty(e)}),p={floorMin:t.floorMin||0,floorRuleValue:t.values[f]||t.default,matchingData:l[0],matchingRule:f};return p.matchingFloor=Math.max(p.floorMin,p.floorRuleValue),j.deepSetValue(t,"matchingInputs.".concat(c),k({},p)),p}function w(e,t){var o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=j.deepAccess(Object(O.a)(),"bidderSettings.".concat(e,".bidCpmAdjustment"))||j.deepAccess(Object(O.a)(),"bidderSettings.standard.bidCpmAdjustment");return r?parseFloat(r(t,k(k({},o),{},{cpm:t}))):parseFloat(t)}function P(e,t){var o=Math.pow(10,10);return e*o/(t*o)*(e*o)/o}var I={banner:function(e){return j.deepAccess(e,"mediaTypes.banner.sizes")||[]},video:function(e){return j.deepAccess(e,"mediaTypes.video.playerSize")||[]},native:function(e){return j.deepAccess(e,"mediaTypes.native.image.sizes")?[j.deepAccess(e,"mediaTypes.native.image.sizes")]:[]}};function M(){var e,t,o,r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{currency:"USD",mediaType:"*",size:"*"},n=this,a=R[n.auctionId];if(!a||a.skipped)return{};e=n,t=r,o=Object.keys(e.mediaTypes||{}),"*"===t.mediaType&&1===o.length&&(t.mediaType=o[0]),"*"===t.size&&-1!==o.indexOf(t.mediaType)&&I[t.mediaType]&&1===I[t.mediaType](e).length&&(t.size=I[t.mediaType](e)[0]),r=t;var i,c,s,u=E(a.data,k({},n),{mediaType:r.mediaType,size:r.size}),d=r.currency||a.data.currency;if(u.matchingFloor&&d!==a.data.currency)try{u.matchingFloor=Object(O.a)().convertCurrency(u.matchingFloor,a.data.currency,d)}catch(e){j.logWarn("".concat(T,": Unable to get currency conversion for getFloor for bidder ").concat(n.bidder,". You must have currency module enabled with defaultRates in your currency config")),d=a.data.currency}return a.enforcement.bidAdjustment&&u.matchingFloor&&(i=w(n.bidder,u.matchingFloor),u.matchingFloor=i?P(u.matchingFloor,i):u.matchingFloor),u.matchingFloor?{floor:(c=u.matchingFloor,s=4,Math.ceil((parseFloat(c)*Math.pow(10,s)).toFixed(1))/Math.pow(10,s)),currency:d}:{}}function B(e,t){var o,r,n,a,i,c=j.deepClone(e);return c.schema.delimiter=e.schema.delimiter||"|",c.values=(r=t,n=(o=c).schema.fields,a=o.schema.delimiter,i=r&&-1===n.indexOf("adUnitCode")&&n.unshift("adUnitCode"),Object.keys(o.values).reduce(function(e,t){return e[(i?"".concat(r).concat(a).concat(t):t).toLowerCase()]=o.values[t],e},{})),c.currency=c.currency||"USD",c}function V(e){return e.reduce(function(e,t){var o;return H(t.floors)&&(e.values?(o=B(t.floors,t.code).values,C(e.values,o)):(e=B(t.floors,t.code)).location="adUnit"),e},{})}function x(e,t,o){e.forEach(function(e){e.bids.forEach(function(e){t.skipped?delete e.getFloor:e.getFloor=M,e.auctionId=o,e.floorData={skipped:t.skipped,skipRate:t.skipRate,floorMin:t.floorMin,modelVersion:j.deepAccess(t,"data.modelVersion"),modelWeight:j.deepAccess(t,"data.modelWeight"),modelTimestamp:j.deepAccess(t,"data.modelTimestamp"),location:j.deepAccess(t,"data.location","noData"),floorProvider:t.floorProvider,fetchStatus:v.fetchStatus}})})}function q(e,t){for(var o=Math.floor(Math.random()*t+1),r=0;r<e.length;r++)if((o-=e[r].modelWeight)<=0)return e[r]}function z(e,t){var o,r,n,a=j.deepClone(v);2===j.deepAccess(a,"data.floorsSchemaVersion")&&(r=(o=a.data).modelGroups,n=f(o,["modelGroups"]),a.data=C(n,q(r,n.modelWeightSum)));var i,c,s=0===Object.keys(j.deepAccess(a,"data.values")||{}).length;return a.data=s?V(e):B(a.data),0===Object.keys(j.deepAccess(a,"data.values")||{}).length?a.skipped=!0:(i=j.getParameterByName("pbjs_skipRate")||a.skipRate,c=100*Math.random()<parseFloat(i),a.skipped=c),a.hasOwnProperty("floorMin")&&(a.data.floorMin=a.floorMin),x(e,a,t),a}function W(t){t.hasExited||(D=D.filter(function(e){return e.timer!==t.timer}),t.reqBidsConfigObj.auctionId=t.reqBidsConfigObj.auctionId||j.generateUUID(),R[t.reqBidsConfigObj.auctionId]=z(t.reqBidsConfigObj.adUnits||Object(O.a)().adUnits,t.reqBidsConfigObj.auctionId),t.nextFn.apply(t.context,[t.reqBidsConfigObj]),t.hasExited=!0)}function G(i,c,s){return"object"===l(i.values)&&(i.values=Object.keys(i.values).reduce(function(e,t){var o,r,n,a;return o=t,r=i.values[t],n=c,a=s,"string"==typeof o&&o.split(a).length===n&&"number"==typeof r&&(e[t]=i.values[t]),e},{}),0<Object.keys(i.values).length)}function N(e){return!!function(e){if(Array.isArray(e)&&0<e.length&&e.every(function(e){return-1!==g.indexOf(e)}))return 1;j.logError("".concat(T,": Fields recieved do not match allowed fields"))}(j.deepAccess(e,"schema.fields"))&&G(e,e.schema.fields.length,e.schema.delimiter||"|")}var _={1:N,2:function(t){return!(!Array.isArray(t.modelGroups)||0===t.modelGroups.length)&&(t.modelWeightSum=0,t.modelGroups.every(function(e){return!("number"!=typeof e.modelWeight||!N(e))&&(t.modelWeightSum+=e.modelWeight,!0)}))}};function H(e){return"object"===l(e)&&(e.floorsSchemaVersion=e.floorsSchemaVersion||1,"function"!=typeof _[e.floorsSchemaVersion]?(j.logError("".concat(T,": Unknown floorsSchemaVersion: "),e.floorsSchemaVersion),!1):_[e.floorsSchemaVersion](e))}function J(e,t){if(e&&"object"===l(e)&&H(e))return j.logInfo("".concat(T,": A ").concat(t," set the auction floor data set to "),e),k(k({},e),{},{location:t});j.logError("".concat(T,": The floors data did not contain correct values"),e)}function L(e,t){var o={reqBidsConfigObj:t,context:this,nextFn:e,haveExited:!1,timer:null};0<v.auctionDelay&&y?(o.timer=setTimeout(function(){j.logWarn("".concat(T,": Fetch attempt did not return in time for auction")),v.fetchStatus="timeout",W(o)},v.auctionDelay),D.push(o)):W(o)}function Y(){D.forEach(function(e){clearTimeout(e.timer),W(e)}),D=[]}function K(t){var o;y=!1,v.fetchStatus="success";try{o=JSON.parse(t)}catch(e){o=t}var e=J(o,"fetch");e&&(v.data=e,v.skipRate=j.isNumber(e.skipRate)?e.skipRate:v.skipRate,v.floorProvider=e.floorProvider||v.floorProvider),Y()}function Q(e){y=!1,v.fetchStatus="error",j.logError("".concat(T,": Fetch errored with: "),e),Y()}function X(e){e.url&&!y?"GET"!==(e.method||"GET")?j.logError("".concat(T,": 'GET' is the only request method supported at this time!")):(h(e.url,{success:K,error:Q},null,{method:"GET"}),y=!0):y&&j.logWarn("".concat(T,": A fetch is already occuring. Skipping."))}function Z(t){(v=j.pick(t,["floorMin","enabled",function(e){return!1!==e},"auctionDelay",function(e){return e||0},"floorProvider",function(e){return j.deepAccess(t,"data.floorProvider",e)},"endpoint",function(e){return e||{}},"skipRate",function(){return isNaN(j.deepAccess(t,"data.skipRate"))?t.skipRate||0:t.data.skipRate},"enforcement",function(e){return j.pick(e||{},["enforceJS",function(e){return!1!==e},"enforcePBS",function(e){return!0===e},"floorDeals",function(e){return!0===e},"bidAdjustment",function(e){return!1!==e}])},"additionalSchemaFields",function(e){return"object"===l(e)&&0<Object.keys(e).length?(t=e,void Object.keys(t).forEach(function(e){-1===g.indexOf(e)&&"function"==typeof t[e]&&(g.push(e),U[e]=t[e])})):void 0;var t},"data",function(e){return e&&J(e,"setConfig")||v.data}])).enabled?(X(v.endpoint),b||(i.a.on(F.a.EVENTS.AUCTION_END,function(e){setTimeout(function(){return delete R[e.auctionId]},3e3)}),Object(O.a)().requestBids.before(L,50),Object(s.a)("addBidResponse").before($,j.debugTurnedOn()?4:50),b=!0)):(j.logInfo("".concat(T,": Turning off module")),v={},R={},Object(s.a)("addBidResponse").getHooks({hook:$}).remove(),Object(O.a)().requestBids.getHooks({hook:L}).remove(),b=!1)}function $(t,o,r){var e=R[this.bidderRequest.auctionId],n=S()(this.bidderRequest.bids,function(e){return e.bidId&&e.bidId===r.requestId});if(!e||!r||e.skipped||!n)return t.call(this,o,r);var a,i=E(e.data,k({},n),k(k({},r),{},{size:[r.width,r.height]}));if(!i.matchingFloor)return j.logWarn("".concat(T,": unable to determine a matching price floor for bidResponse"),r),t.call(this,o,r);var c,s,u,d,l,f,p,m,h,g,y=e.data.currency.toUpperCase(),b=r.currency||"USD";if(y===b.toUpperCase())a=r.cpm;else if(r.originalCurrency&&y===r.originalCurrency.toUpperCase())a=r.originalCpm;else try{a=Object(O.a)().convertCurrency(r.cpm,b.toUpperCase(),y)}catch(e){return j.logError("".concat(T,": Unable do get currency conversion for bidResponse to Floor Currency. Do you have Currency module enabled? ").concat(r)),t.call(this,o,r)}if(a=w(r.bidderCode,a,r),c=e,s=i,d=a,(u=r).floorData={floorValue:s.matchingFloor,floorRule:s.matchingRule,floorRuleValue:s.floorRuleValue,floorCurrency:c.data.currency,cpmAfterAdjustments:d,enforcements:k({},c.enforcement),matchedFields:{}},c.data.schema.fields.forEach(function(e,t){var o=s.matchingData.split(c.data.schema.delimiter)[t];u.floorData.matchedFields[e]=o}),l=e,f=i,p=r,m=!1!==j.deepAccess(l,"enforcement.enforceJS"),h=!0===j.deepAccess(l,"enforcement.floorDeals")||!p.dealId,g=p.floorData.cpmAfterAdjustments<f.matchingFloor,m&&g&&h){var v=Object(A.a)(F.a.STATUS.NO_BID,n);return C(v,j.pick(r,["floorData","width","height","mediaType","currency","originalCpm","originalCurrency","getCpmInNewCurrency"])),v.status=F.a.BID_STATUS.BID_REJECTED,v.cpm=0,j.logWarn("".concat(T,": ").concat(v.bidderCode,"'s Bid Response for ").concat(o," was rejected due to floor not met"),r),t.call(this,o,v)}return t.call(this,o,r)}r.b.getConfig("floors",function(e){return Z(e.floors)})}},[708]);