pbjsChunk([129],{824:function(e,i,n){e.exports=n(825)},825:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),n.d(i,"internal",function(){return z}),n.d(i,"sizeMappingInternalStore",function(){return h}),i.isUsingNewSizeMapping=o,i.checkAdUnitSetupHook=d,i.checkBidderSizeConfigFormat=c,i.isLabelActivated=s,i.getFilteredMediaTypes=p,i.isSizeConfigActivated=f,i.getActiveSizeBucket=m,i.getRelevantMediaTypesForBidder=A,i.getAdUnitDetail=T,i.getBids=C;var g=n(0),v=n(38),y=n(67),t=n(13),l=n.n(t),a=n(11),u=n(70);function b(){return(b=Object.assign||function(e){for(var i=1;i<arguments.length;i++){var n=arguments[i];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e}).apply(this,arguments)}var r,z={checkBidderSizeConfigFormat:c,getActiveSizeBucket:m,getFilteredMediaTypes:p,getAdUnitDetail:T,getRelevantMediaTypesForBidder:A,isLabelActivated:s},h=(r={},{initializeStore:function(e,i){r[e]={usingSizeMappingV2:i,adUnits:[]}},getAuctionDetail:function(e){return r[e]},setAuctionDetail:function(e,i){r[e].adUnits.push(i)}});function o(e){var n=!1;return e.forEach(function(i){i.mediaTypes&&(Object.keys(i.mediaTypes).forEach(function(e){i.mediaTypes[e].sizeConfig&&!1===n&&(n=!0)}),i.bids&&g.isArray(i.bids)&&i.bids.forEach(function(e){e.sizeConfig&&!1===n&&(n=!0)}))}),n}function d(e){function d(r,e,o){var d=!0,c={banner:"sizes",video:"playerSize",native:"active"}[r],s={banner:"Removing mediaTypes.banner from ad unit.",video:"Removing mediaTypes.video.sizeConfig from ad unit.",native:"Removing mediaTypes.native.sizeConfig from ad unit."};return Array.isArray(e)?(e.forEach(function(e,i){var n=Object.keys(e);if(!l()(n,"minViewPort")||!l()(n,c))return g.logError("Ad unit ".concat(o,": Missing required property 'minViewPort' or 'sizes' from 'mediaTypes.").concat(r,".sizeConfig[").concat(i,"]'. ").concat(s[r])),void(d=!1);if(!g.isArrayOfNums(e.minViewPort,2))return g.logError("Ad unit ".concat(o,": Invalid declaration of 'minViewPort' in 'mediaTypes.").concat(r,".sizeConfig[").concat(i,"]'. ").concat(s[r])),void(d=!1);if("banner"===r||"video"===r){var t,a=!1;if(Array.isArray(e[c])?(t=u.adUnitSetupChecks.validateSizes(e[c]),0<e[c].length&&0===t.length&&(a=!(d=!1))):a=!(d=!1),a)return void g.logError("Ad unit ".concat(o,": Invalid declaration of '").concat(c,"' in 'mediaTypes.").concat(r,".sizeConfig[").concat(i,"]'. ").concat(s[r]))}"native"===r&&"boolean"!=typeof e[c]&&(g.logError("Ad unit ".concat(o,": Invalid declaration of 'active' in 'mediaTypes.").concat(r,".sizeConfig[").concat(i,"]'. ").concat(s[r])),d=!1)}),d):(g.logError("Ad unit ".concat(o,": Invalid declaration of 'sizeConfig' in 'mediaTypes.").concat(r,".sizeConfig'. ").concat(s[r])),d=!1)}var c=[];return e.forEach(function(e){var i,n,t,a,r=e.bids,o=e.mediaTypes;r&&g.isArray(r)?o&&0!==Object.keys(o).length?(o.banner&&(o.banner.sizes?i=u.adUnitSetupChecks.validateBannerMediaType(e):o.banner.sizeConfig?(i=g.deepClone(e),d("banner",o.banner.sizeConfig,e.code)?i.mediaTypes.banner.sizeConfig.forEach(function(e){Array.isArray(e.sizes[0])||(e.sizes=[e.sizes])}):delete i.mediaTypes.banner):(g.logError("Ad unit ".concat(e.code,": 'mediaTypes.banner' does not contain either 'sizes' or 'sizeConfig' property. Removing 'mediaTypes.banner' from ad unit.")),delete(i=g.deepClone(e)).mediaTypes.banner)),o.video&&(o.video.playerSize?n=i?u.adUnitSetupChecks.validateVideoMediaType(i):u.adUnitSetupChecks.validateVideoMediaType(e):o.video.sizeConfig&&(n=i||g.deepClone(e),d("video",o.video.sizeConfig,e.code)?n.mediaTypes.video.sizeConfig.forEach(function(e){Array.isArray(e.playerSize[0])||(e.playerSize=[e.playerSize])}):delete n.mediaTypes.video.sizeConfig)),o.native&&(t=n?u.adUnitSetupChecks.validateNativeMediaType(n):i?u.adUnitSetupChecks.validateNativeMediaType(i):u.adUnitSetupChecks.validateNativeMediaType(e),o.native.sizeConfig&&(d("native",o.native.sizeConfig,e.code)||delete t.mediaTypes.native.sizeConfig)),a=b({},i,n,t),c.push(a)):g.logError("Detected adUnit.code '".concat(e.code,"' did not have a 'mediaTypes' object defined. This is a required field for the auction, so this adUnit has been removed.")):g.logError("Detected adUnit.code '".concat(e.code,"' did not have 'adUnit.bids' defined or 'adUnit.bids' is not an array. Removing adUnit from auction."))}),c}function c(e){var n=!0;return Array.isArray(e)&&0<e.length?e.forEach(function(e){var i=Object.keys(e);n=!!(l()(i,"minViewPort")&&l()(i,"relevantMediaTypes")&&g.isArrayOfNums(e.minViewPort,2)&&Array.isArray(e.relevantMediaTypes)&&0<e.relevantMediaTypes.length&&(1<e.relevantMediaTypes.length?e.relevantMediaTypes.every(function(e){return l()(["banner","video","native"],e)}):-1<["none","banner","video","native"].indexOf(e.relevantMediaTypes[0])))&&(n&&!0)}):n=!1,n}function s(e,i,n,t){var a,r=Object.keys(e).filter(function(e){return"labelAny"===e||"labelAll"===e});return r&&1<r.length&&g.logWarn("Size Mapping V2:: ".concat(e.code?"Ad Unit: ".concat(e.code,"(").concat(t,") => Ad unit has multiple label operators. Using the first declared operator: ").concat(r[0]):"Ad Unit: ".concat(n,"(").concat(t,"), Bidder: ").concat(e.bidder," => Bidder has multiple label operators. Using the first declared operator: ").concat(r[0]))),(a=r[0])&&!i?(g.logWarn("Size Mapping V2:: ".concat(e.code?"Ad Unit: ".concat(e.code,"(").concat(t,") => Found '").concat(a,"' on ad unit, but 'labels' is not set. Did you pass 'labels' to pbjs.requestBids() ?"):"Ad Unit: ".concat(n,"(").concat(t,"), Bidder: ").concat(e.bidder," => Found '").concat(a,"' on bidder, but 'labels' is not set. Did you pass 'labels' to pbjs.requestBids() ?"))),!0):"labelAll"===a&&Array.isArray(e[a])?0===e.labelAll.length?(g.logWarn("Size Mapping V2:: Ad Unit: ".concat(e.code,"(").concat(t,") => Ad unit has declared property 'labelAll' with an empty array.")),!0):e.labelAll.every(function(e){return l()(i,e)}):"labelAny"!==a||!Array.isArray(e[a])||(0===e.labelAny.length?(g.logWarn("Size Mapping V2:: Ad Unit: ".concat(e.code,"(").concat(t,") => Ad unit has declared property 'labelAny' with an empty array.")),!0):e.labelAny.some(function(e){return l()(i,e)}))}function p(a){var i,n,r=g.deepClone(a),o={banner:void 0,video:void 0,native:void 0};try{i=g.getWindowTop().innerWidth,n=g.getWindowTop().innerHeight}catch(e){g.logWarn("SizeMappingv2:: Unfriendly iframe blocks viewport size to be evaluated correctly"),i=window.innerWidth,n=window.innerHeight}var d=[i,n];Object.keys(a).map(function(i){var e,n,t=a[i].sizeConfig;t&&(o[i]=m(t,d),e=t.filter(function(e){return e.minViewPort===o[i]&&f(i,e)}),r[i]=b({filteredSizeConfig:e},a[i]),n={banner:"sizes",video:"playerSize"},0<r[i].filteredSizeConfig.length?"native"!==i&&(r[i][n[i]]=r[i].filteredSizeConfig[0][n[i]]):delete r[i])});var e=Object.keys(o).filter(function(e){return void 0!==o[e]}).reduce(function(e,i){return e[i]={activeSizeBucket:o[i],activeSizeDimensions:"banner"===i?r.banner?r.banner.sizes:[]:"video"===i?r.video?r.video.playerSize:[]:"NA"},e},{});return{mediaTypes:a,sizeBucketToSizeMap:e,activeViewport:d,transformedMediaTypes:r}}function f(e,i){switch(e){case"banner":return i.sizes&&0<i.sizes.length&&0<i.sizes[0].length;case"video":return i.playerSize&&0<i.playerSize.length&&0<i.playerSize[0].length;case"native":return i.active;default:return!1}}function m(e,i){var n=[];return e.sort(function(e,i){return e.minViewPort[0]-i.minViewPort[0]}).forEach(function(e){i[0]>=e.minViewPort[0]&&(n=i[1]>=e.minViewPort[1]?e.minViewPort:[])}),n}function A(e,i){if(z.checkBidderSizeConfigFormat(e)){var n=z.getActiveSizeBucket(e,i);return e.filter(function(e){return e.minViewPort===n})[0].relevantMediaTypes}return[]}function T(e,i,n){var t=h.getAuctionDetail(e).adUnits,a=t.filter(function(e){return e.adUnitCode===i.code&&g.deepEqual(e.mediaTypes,i.mediaTypes)});if(0<a.length)return a[0].cacheHits++,a[0];var r=t.filter(function(e){return e.adUnitCode===i.code}),o=0<r.length&&"number"==typeof r[0].instance?r[r.length-1].instance+1:1,d=z.isLabelActivated(i,n,i.code,o),c=d&&z.getFilteredMediaTypes(i.mediaTypes),s=c.mediaTypes,l=void 0===s?i.mediaTypes:s,u=c.sizeBucketToSizeMap,p=c.activeViewport,f=c.transformedMediaTypes,v={adUnitCode:i.code,mediaTypes:l,sizeBucketToSizeMap:u,activeViewport:p,transformedMediaTypes:f,instance:o,isLabelActivated:d,cacheHits:0};return h.setAuctionDetail(e,v),d&&g.logInfo("Size Mapping V2:: Ad Unit: ".concat(i.code,"(").concat(o,") => Active size buckets after filtration: "),u),v}function C(e){var s=e.bidderCode,l=e.auctionId,u=e.bidderRequestId,i=e.adUnits,p=e.labels,f=e.src;return i.reduce(function(e,r){if(!r.mediaTypes||!g.isValidMediaTypes(r.mediaTypes))return g.logWarn("Size Mapping V2:: Ad Unit: ".concat(r.code," => Ad unit has declared invalid 'mediaTypes' or has not declared a 'mediaTypes' property")),e;var i=z.getAdUnitDetail(l,r,p),o=i.activeViewport,d=i.transformedMediaTypes,c=i.instance,n=i.isLabelActivated,t=i.cacheHits;if(n){if(0===Object.keys(d).length)return 0===t&&g.logInfo("Size Mapping V2:: Ad Unit: ".concat(r.code,"(").concat(c,") => Ad unit disabled since there are no active media types after sizeConfig filtration.")),e;e.push(r.bids.filter(function(e){return e.bidder===s}).reduce(function(e,i){if(z.isLabelActivated(i,p,r.code,c)){var n=r.nativeParams||g.deepAccess(r,"mediaTypes.native");if(n&&(i=b({},i,{nativeParams:Object(v.h)(n)})),(i=b({},i,g.getDefinedParams(r,["mediaType","renderer"]))).sizeConfig){var t=z.getRelevantMediaTypesForBidder(i.sizeConfig,o);if(0===t.length)g.logError("Size Mapping V2:: Ad Unit: ".concat(r.code,"(").concat(c,"), Bidder: ").concat(s," => 'sizeConfig' is not configured properly. This bidder won't be eligible for sizeConfig checks and will remail active.")),i=b({},i);else{if("none"===t[0])return g.logInfo("Size Mapping V2:: Ad Unit: ".concat(r.code,"(").concat(c,"), Bidder: ").concat(i.bidder," => 'relevantMediaTypes' is set to 'none' in sizeConfig for current viewport size. This bidder is disabled.")),e;var a=Object.keys(d).filter(function(e){return-1<t.indexOf(e)}).reduce(function(e,i){return e[i]=d[i],e},{});if(!(0<Object.keys(a).length))return g.logInfo("Size Mapping V2:: Ad Unit: ".concat(r.code,"(").concat(c,"), Bidder: ").concat(i.bidder," => 'relevantMediaTypes' does not match with any of the active mediaTypes at the Ad Unit level. This bidder is disabled.")),e;i=b({},i,{mediaTypes:a})}}return e.push(b({},i,{adUnitCode:r.code,transactionId:r.transactionId,sizes:g.deepAccess(d,"banner.sizes")||g.deepAccess(d,"video.playerSize")||[],mediaTypes:i.mediaTypes||d,bidId:i.bid_id||g.getUniqueIdentifierStr(),bidderRequestId:u,auctionId:l,src:f,bidRequestsCount:y.a.getRequestsCounter(r.code),bidderRequestsCount:y.a.getBidderRequestsCounter(r.code,i.bidder),bidderWinsCount:y.a.getBidderWinsCounter(r.code,i.bidder)})),e}return g.logInfo("Size Mapping V2:: Ad Unit: ".concat(r.code,"(").concat(c,"), Bidder: ").concat(i.bidder," => Label check for this bidder has failed. This bidder is disabled.")),e},[]))}else 0===t&&g.logInfo("Size Mapping V2:: Ad Unit: ".concat(r.code,"(").concat(c,") => Ad unit is disabled due to failing label check."));return e},[]).reduce(g.flatten,[]).filter(function(e){return""!==e})}Object(a.a)("checkAdUnitSetup").before(function(e,i){return o(i)?(i=d(i),e.bail(i)):e.call(this,i)}),Object(a.a)("getBids").before(function(e,i){var n;if(void 0===h.getAuctionDetail(i.auctionId)&&(n=o(i.adUnits),h.initializeStore(i.auctionId,n)),h.getAuctionDetail(i.auctionId).usingSizeMappingV2){var t=C(i);return e.bail(t)}return e.call(this,i)})}},[824]);